(function(){tinymce.PluginManager.requireLangPack("asciisvg");tinymce.create("tinymce.plugins.AsciisvgPlugin",{init:function(a,b){var c=this;a.addCommand("mceAsciisvg",function(){el=a.selection.getNode();if(el.nodeName=="IMG"&&a.dom.getAttrib(el,"sscr")!=""){sscr=a.dom.getAttrib(el,"sscr");isnew=false;elwidth=parseInt(a.dom.getStyle(el,"width"));elheight=parseInt(a.dom.getStyle(el,"height"));alignm=a.dom.getStyle(el,"float");if(alignm=="none"){alignm=a.dom.getStyle(el,"vertical-align")}}else{isnew=true;sscr="-7.5,7.5,-5,5,1,1,1,1,1,300,200";elwidth=300;elheight=200;alignm="middle"}a.windowManager.open({file:b+"/asciisvgdlg.htm",width:630+parseInt(a.getLang("asciisvg.delta_width",0)),height:440+parseInt(a.getLang("asciisvg.delta_height",0)),inline:1},{plugin_url:b,isnew:isnew,sscr:sscr,width:elwidth,height:elheight,alignm:alignm,AScgiloc:a.getParam("AScgiloc")})});a.addButton("asciisvg",{title:"asciisvg.desc",cmd:"mceAsciisvg",image:b+"/img/ed_asciisvg.gif"});a.onNodeChange.add(function(e,d,f){d.setActive("asciisvg",f.nodeName=="IMG"&&e.dom.getAttrib(f,"sscr")!="")});a.onPostProcess.add(function(d,f){if(f.get){var g=f.content.match(/<img[^>]*sscr[^>]*>/gi);if(g!=null){for(var e=0;e<g.length;e++){sscr=g[e].replace(/.*sscr=\"?(.*?)[\"\s].*/,"$1");style=g[e].replace(/.*style=\"(.*?)\".*/,"$1");rep='<embed type="image/svg+xml" src="'+d.getParam("ASdloc")+'" style="'+style+'" sscr="'+decodeURIComponent(sscr)+'" />';f.content=f.content.replace(g[e],rep)}}}});a.onBeforeSetContent.add(function(d,f){var g=f.content.match(/<embed[^>]*sscr[^>]*>/gi);if(g!=null){for(var e=0;e<g.length;e++){sscr=g[e].replace(/.*sscr=\"?(.*?)[\"\s].*/,"$1");style=g[e].replace(/.*style=\"(.*?)\".*/,"$1");rep='<img src="'+d.getParam("AScgiloc")+"?sscr="+sscr+'" style="'+style+'" sscr="'+decodeURIComponent(sscr)+'" />';f.content=f.content.replace(g[e],rep)}}});a.onEvent.add(function(d,f){if(f.type=="mouseup"){el=d.selection.getNode();if(el.nodeName=="IMG"&&d.dom.getAttrib(el,"sscr")!=""){setTimeout(function(){c.processresize(d,el)},50)}}})},getInfo:function(){return{longname:"Asciisvg plugin",author:"David Lippman",authorurl:"",infourl:"",version:"1.0"}},processresize:function(a,b){width=parseInt(b.getAttribute("width"));height=parseInt(a.dom.getAttrib(b,"height"));if(width>0&&height>0){sscra=decodeURIComponent(b.getAttribute("sscr")).split(",");sscra[9]=width;sscra[10]=height;sscr=sscra.join(",");a.dom.setAttrib(b,"sscr",sscr);a.dom.setAttrib(b,"src",a.getParam("AScgiloc")+"?sscr="+encodeURIComponent(sscr));a.dom.setStyle(b,"width",width+"px");a.dom.setStyle(b,"height",height+"px")}}});tinymce.PluginManager.add("asciisvg",tinymce.plugins.AsciisvgPlugin)})();